<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Ë®≠ÂÆö (‰øÆÊ≠£Ë≠¶Âëä) -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">

    <!-- Âä†ÂÖ• Favicon (Ëß£Ê±∫ 404 ÈåØË™§) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">

    <title>Baymax Health OS</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- ÂºïÂÖ• Markdown Ëß£ÊûêÂô® -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- ÂºïÂÖ•ÈªûÈô£Â≠óÈ´î DotGothic16 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rose: { 50: '#fff1f2', 100: '#ffe4e6', 400: '#fb7185', 500: '#f43f5e', 600: '#e11d48' },
                        slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 700: '#334155', 800: '#1e293b', 900: '#0f172a' },
                        amber: { 400: '#fbbf24', 500: '#f59e0b' }
                    },
                    animation: {
                        'fade-in': 'fade-in 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'slide-up': 'slide-up 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'blink': 'blink 4s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'breathe': 'breathe 4s ease-in-out infinite',
                    },
                    padding: {
                        'safe-top': 'env(safe-area-inset-top)',
                        'safe-bottom': 'env(safe-area-inset-bottom)',
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.03)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -1px rgba(0, 0, 0, 0.02)',
                        'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.5)',
                        'poster': '0 10px 30px -10px rgba(0,0,0,0.3)',
                    },
                    fontFamily: {
                        'dot': ['"DotGothic16"', 'monospace', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fade-in { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 0%, 96%, 100% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { overscroll-behavior-y: none; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        
        /* Markdown Ê®£Âºè */
        .markdown-body { font-family: "DotGothic16", monospace; line-height: 1.8; font-size: 1.05rem; }
        .markdown-body h1, .markdown-body h2, .markdown-body h3 { font-weight: bold; margin-top: 1.5em; margin-bottom: 0.5em; color: #1e293b; }
        .markdown-body p { margin-bottom: 1em; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .markdown-body ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .markdown-body li { margin-bottom: 0.5em; }
        .markdown-body code { background-color: #f1f5f9; padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; color: #e11d48; font-size: 0.9em; }
        .markdown-body pre { background-color: #1e293b; color: #f8fafc; padding: 1em; border-radius: 0.5em; overflow-x: auto; margin-bottom: 1em; }
        .markdown-body pre code { background-color: transparent; color: inherit; padding: 0; }
        .markdown-body strong { color: #0ea5e9; }
    </style>
</head>
<body class="bg-slate-200 text-slate-600 font-sans h-[100dvh] w-screen flex justify-center items-center overflow-hidden selection:bg-rose-200">

    <div id="root" class="w-full h-full flex justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const API_KEY = "AIzaSyAivr5Oz_DPqVAMe3lcfdpwurxUmsry4lo"; 
        
        // Vercel Proxy Á∂≤ÂùÄ (Â∑≤Êõ¥Êñ∞ÁÇ∫ÊÇ®Êèê‰æõÁöÑ omega-khaki ÁâàÊú¨)
        const PROXY_BASE = "https://gemini-api-proxy-omega-khaki.vercel.app";
        const API_URL = `${PROXY_BASE}/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent`;

        // --- Icons (Lucide) ---
        const Icons = {
            ChevronLeft: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            Stethoscope: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/><path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"/><circle cx="20" cy="10" r="2"/></svg>,
            BookA: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="m8 13 4-7 4 7"/><path d="M9.1 11h5.7"/></svg>,
            Shirt: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/></svg>,
            Camera: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            X: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Sparkles: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
            Plus: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Trash2: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            Lock: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Eye: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            EyeOff: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>,
            Download: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Film: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M7 3v18"/><path d="M3 7.5h4"/><path d="M3 12h18"/><path d="M3 16.5h4"/><path d="M17 3v18"/><path d="M17 7.5h4"/><path d="M17 16.5h4"/></svg>,
            Star: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Calendar: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Edit3: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>,
            Timer: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Play: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            RotateCcw: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Settings: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            GraduationCap: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 0 6-2 6-5.5V10"/></svg>,
            MessageSquare: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            PenLine: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
        };

        const BaymaxEyes = () => (
            <div className="flex items-center gap-2 animate-blink">
                <div className="w-2.5 h-2.5 bg-slate-800 rounded-full"></div>
                <div className="w-8 h-0.5 bg-slate-800"></div>
                <div className="w-2.5 h-2.5 bg-slate-800 rounded-full"></div>
            </div>
        );

        const FullBodyBaymax = ({ pose = 'idle' }) => (
            <svg viewBox="0 0 200 240" className="w-48 h-auto drop-shadow-xl animate-breathe">
                <ellipse cx="100" cy="130" rx="70" ry="85" fill="white" stroke="#1e293b" strokeWidth="2.5" />
                <ellipse cx="100" cy="50" rx="35" ry="25" fill="white" stroke="#1e293b" strokeWidth="2.5" />
                <circle cx="85" cy="50" r="4" fill="#1e293b" />
                <circle cx="115" cy="50" r="4" fill="#1e293b" />
                <line x1="85" y1="50" x2="115" y2="50" stroke="#1e293b" strokeWidth="2" />
                <ellipse cx="25" cy="110" rx="18" ry="45" fill="white" stroke="#1e293b" strokeWidth="2.5" transform="rotate(20 25 110)" />
                <path d="M65 185 L65 220 A 15 15 0 0 0 95 220 L95 185" fill="white" stroke="#1e293b" strokeWidth="2.5" />
                <path d="M105 185 L105 220 A 15 15 0 0 0 135 220 L135 185" fill="white" stroke="#1e293b" strokeWidth="2.5" />
                <path d="M60 180 Q100 195 140 180" fill="white" stroke="white" strokeWidth="4" />
                <path d="M60 180 Q100 195 140 180" fill="none" stroke="#1e293b" strokeWidth="2.5" />
                <ellipse cx="175" cy="110" rx="18" ry="45" fill="white" stroke="#1e293b" strokeWidth="2.5" transform="rotate(-20 175 110)" />
                <circle cx="125" cy="100" r="8" fill="#e2e8f0" stroke="#94a3b8" strokeWidth="1" opacity="0.8" />
            </svg>
        );

        async function callGemini(parts, systemPrompt) {
            if (!API_KEY) throw new Error("Ë´ãÂÖàÂ°´ÂÖ• API Key");

            try {
                // ‰ΩøÁî®ÊåáÂÆöÁöÑ Vercel Proxy
                const response = await fetch(
                    `${API_URL}?key=${API_KEY}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ role: "user", parts: parts }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { responseMimeType: "application/json" }
                        }),
                    }
                );
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errorText}`);
                }
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                return JSON.parse(text.replace(/```json|```/g, '').trim());

            } catch (error) {
                console.error("API Call Failed:", error);
                
                // ÈáùÂ∞ç CORS ÈåØË™§Êèê‰æõÂèãÂñÑÊèêÁ§∫
                if (error.message.includes("Failed to fetch") || error.name === 'TypeError') {
                    alert(
                        "‚ö†Ô∏è CORS ÈÄ£Á∑öÈåØË™§ (Access Blocked)\n\n" +
                        "ÂéüÂõ†ÔºöVercel ‰º∫ÊúçÂô®ÊãíÁµï‰∫ÜÊÇ®ÁöÑÈÄ£Á∑ö„ÄÇ\n" +
                        "Ëß£Ê±∫ÊñπÊ≥ïÔºö\n" +
                        "1. Â¶ÇÊûúÈÄôÊòØÊÇ®ÁöÑ Vercel Â∞àÊ°àÔºåË´ãÂú® vercel.json ‰∏≠Âä†ÂÖ• CORS Header„ÄÇ\n" +
                        "2. Â¶ÇÊûú‰∏çÊòØÔºåË´ã‰ΩøÁî®ÁÄèË¶ΩÂô®Â§ñÊéõ 'Allow CORS' (ÂÉÖÈôêÊ∏¨Ë©¶)„ÄÇ"
                    );
                } else {
                    alert("ÈÄ£Á∑öÂ§±ÊïóÔºö" + error.message);
                }
                throw error;
            }
        }

        // ==========================================
        // üéì Â∑•ÂÖ∑ 7: Â≠∏ÁøíÂä©Êâã (Learning Assistant)
        // ==========================================
        function ToolLearning({ onBack }) {
            const [mode, setMode] = useState('qa'); // 'qa' | 'photo' | 'grammar'
            const [input, setInput] = useState('');
            const [image, setImage] = useState(null);
            const [result, setResult] = useState(null);
            const [loading, setLoading] = useState(false);

            const handleQASubmit = async () => {
                if (!input.trim()) return;
                setLoading(true);
                try {
                    const prompt = `You are Baymax, a helpful learning assistant. Answer clearly. Use Markdown formatting. JSON: { "answer": "String (Markdown)" }`;
                    const data = await callGemini([{ text: input }], prompt);
                    setResult(data);
                } catch (e) { }
                setLoading(false);
            };

            const handlePhotoSubmit = async () => {
                if (!image) return;
                setLoading(true);
                try {
                    const imgData = await new Promise(r => { const reader=new FileReader(); reader.readAsDataURL(image.file); reader.onload=()=>r(reader.result.split(',')[1]); });
                    const prompt = `You are Baymax. Solve this problem step-by-step. Use Markdown. JSON: { "solution": "String (Markdown)" }`;
                    const data = await callGemini([{ inlineData: { data: imgData, mimeType: image.file.type } }, { text: "Solve this" }], prompt);
                    setResult(data);
                } catch (e) { }
                setLoading(false);
            };

            const handleGrammarSubmit = async () => {
                if (!input.trim()) return;
                setLoading(true);
                try {
                    const prompt = `Check grammar. JSON: { "corrected": "String (Markdown)", "explanation": "String (Markdown)" }`;
                    const data = await callGemini([{ text: input }], prompt);
                    setResult(data);
                } catch (e) { }
                setLoading(false);
            };

            const handleFile = (e) => { const file = e.target.files[0]; if(file) setImage({ file, preview: URL.createObjectURL(file) }); };

            const renderResult = () => {
                if (!result) return null;
                return (
                    <div className="bg-slate-50 p-5 rounded-2xl shadow-inner border-2 border-slate-200 mt-4 animate-fade-in relative overflow-hidden">
                        <div className="absolute inset-0 pointer-events-none opacity-5 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_2px,3px_100%]"></div>
                        <div className="markdown-body text-slate-800">
                            {mode === 'qa' && <div dangerouslySetInnerHTML={{ __html: marked.parse(result.answer) }} />}
                            {mode === 'photo' && <div dangerouslySetInnerHTML={{ __html: marked.parse(result.solution) }} />}
                            {mode === 'grammar' && (
                                <>
                                    <h4 className="text-sm font-bold text-sky-600 mb-2 font-dot border-b-2 border-sky-200 pb-1 inline-block">CORRECTED_TEXT_</h4>
                                    <div className="bg-white p-3 rounded-lg border border-slate-200 mb-4 font-dot" dangerouslySetInnerHTML={{ __html: marked.parse(result.corrected) }} />
                                    <h4 className="text-sm font-bold text-sky-600 mb-2 font-dot border-b-2 border-sky-200 pb-1 inline-block">ANALYSIS_LOG_</h4>
                                    <div className="text-sm" dangerouslySetInnerHTML={{ __html: marked.parse(result.explanation) }} />
                                </>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-50 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center gap-3 p-6 sticky top-0 z-10 bg-slate-50/90 backdrop-blur-md">
                        <button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm"><Icons.ChevronLeft className="text-slate-600" /></button>
                        <h2 className="text-xl font-bold text-slate-700">Â≠∏ÁøíÂä©Êâã</h2>
                    </div>
                    <div className="px-6 pb-2">
                        <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-100">
                            <button onClick={() => {setMode('qa'); setResult(null); setInput(''); setImage(null);}} className={`flex-1 py-2 rounded-xl text-sm font-bold transition font-dot ${mode === 'qa' ? 'bg-indigo-100 text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>ÂïèÁ≠î</button>
                            <button onClick={() => {setMode('photo'); setResult(null); setInput(''); setImage(null);}} className={`flex-1 py-2 rounded-xl text-sm font-bold transition font-dot ${mode === 'photo' ? 'bg-indigo-100 text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>Ëß£È°å</button>
                            <button onClick={() => {setMode('grammar'); setResult(null); setInput(''); setImage(null);}} className={`flex-1 py-2 rounded-xl text-sm font-bold transition font-dot ${mode === 'grammar' ? 'bg-indigo-100 text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}>ÊñáÊ≥ï</button>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 no-scrollbar pb-safe-bottom">
                        <div className="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 mb-4 transition-all focus-within:ring-2 focus-within:ring-indigo-100">
                            {mode === 'qa' && (
                                <div className="flex gap-2">
                                    <textarea value={input} onChange={e => setInput(e.target.value)} placeholder="Ëº∏ÂÖ•ÂïèÈ°å..." className="flex-1 bg-transparent resize-none outline-none h-24 placeholder-slate-300 font-dot" />
                                    <div className="flex flex-col justify-end"><button onClick={handleQASubmit} disabled={loading || !input.trim()} className="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white shadow-lg shadow-indigo-200 disabled:opacity-50 hover:bg-indigo-600 transition">{loading ? <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"/> : <Icons.MessageSquare size={18}/>}</button></div>
                                </div>
                            )}
                            {mode === 'photo' && (
                                <div className="flex flex-col gap-4">
                                    {image ? (
                                        <div className="relative w-full h-48 rounded-xl overflow-hidden shadow-inner bg-slate-100 border-2 border-dashed border-slate-300">
                                            <img src={image.preview} className="w-full h-full object-contain" />
                                            <button onClick={() => setImage(null)} className="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1"><Icons.X size={14}/></button>
                                        </div>
                                    ) : (
                                        <label className="w-full h-32 border-2 border-dashed border-slate-200 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-slate-50 transition group">
                                            <input type="file" accept="image/*" onChange={handleFile} className="hidden" />
                                            <Icons.Camera className="text-slate-300 mb-2 group-hover:scale-110 transition"/>
                                            <span className="text-xs text-slate-400 font-dot">UPLOAD_IMAGE</span>
                                        </label>
                                    )}
                                    <button onClick={handlePhotoSubmit} disabled={loading || !image} className="w-full bg-indigo-500 text-white py-3 rounded-xl font-bold disabled:opacity-50 hover:bg-indigo-600 transition shadow-lg shadow-indigo-200 font-dot">{loading ? "ANALYZING..." : "ÈñãÂßãËß£È°å"}</button>
                                </div>
                            )}
                            {mode === 'grammar' && (
                                <div className="flex flex-col gap-3">
                                    <textarea value={input} onChange={e => setInput(e.target.value)} placeholder="Paste text here..." className="w-full bg-transparent resize-none outline-none h-32 placeholder-slate-300 font-mono text-sm" />
                                    <div className="flex justify-end"><button onClick={handleGrammarSubmit} disabled={loading || !input.trim()} className="bg-indigo-500 text-white px-6 py-2 rounded-xl font-bold disabled:opacity-50 hover:bg-indigo-600 transition shadow-lg shadow-indigo-200 flex items-center gap-2 font-dot text-sm">{loading ? "CHECKING..." : <><Icons.PenLine size={16}/> Ê™¢Êü•ÊñáÊ≥ï</>}</button></div>
                                </div>
                            )}
                        </div>
                        {renderResult()}
                    </div>
                </div>
            );
        }

        // (Other Tools remain unchanged: ToolPomodoro, ToolMovie, ToolPassword, ToolBaymax, ToolVocab, ToolClothes)
        // ... [ÁÇ∫‰∫ÜÁØÄÁúÅÁØáÂπÖÔºåÂÖ∂‰ªñÂ∑•ÂÖ∑‰ª£Á¢ºËàáÂâç‰∏ÄÁâàÊú¨ÂÆåÂÖ®Áõ∏ÂêåÔºåË´ãÁ¢∫‰øùË§áË£ΩÂÆåÊï¥Ê™îÊ°à] ...
        
        function ToolPomodoro({ onBack }) {
            const [workMinutes, setWorkMinutes] = useState(25);
            const [breakMinutes, setBreakMinutes] = useState(5);
            const [timeLeft, setTimeLeft] = useState(workMinutes * 60);
            const [isActive, setIsActive] = useState(false);
            const [mode, setMode] = useState('work');
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            useEffect(() => { if (!isActive) { setTimeLeft(mode === 'work' ? workMinutes * 60 : breakMinutes * 60); } }, [workMinutes, breakMinutes]);
            useEffect(() => { let interval = null; if (isActive && timeLeft > 0) { interval = setInterval(() => setTimeLeft(t => t - 1), 1000); } else if (timeLeft === 0) { setIsActive(false); handleTimerComplete(); } return () => clearInterval(interval); }, [isActive, timeLeft]);
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'zh-TW';
                    utterance.rate = 0.8; 
                    utterance.pitch = 0.6;
                    const voices = window.speechSynthesis.getVoices();
                    const maleVoice = voices.find(v => v.lang.includes('zh') && (v.name.includes('Male') || v.name.includes('Zhiwei')));
                    const googleVoice = voices.find(v => v.name.includes("Google") && v.lang.includes("zh"));
                    if (maleVoice) { utterance.voice = maleVoice; utterance.pitch = 0.9; } else if (googleVoice) { utterance.voice = googleVoice; utterance.pitch = 0.6; }
                    window.speechSynthesis.speak(utterance);
                }
            };
            const handleStart = () => { setIsActive(!isActive); if (!isActive) { if (mode === 'work') { speak("‰Ω†Â•ΩÔºåÊàëÊòØÂ§ßÁôΩ„ÄÇÂ∞àÊ≥®Ê®°ÂºèÂïüÂãï„ÄÇÊàëÊúÉÂú®ÈÄôË£°Èô™‰º¥‰Ω†„ÄÇ"); } else { speak("‰ºëÊÅØÊ®°ÂºèÂïüÂãï„ÄÇË´ãÊîæÈ¨ÜË∫´ÂøÉ„ÄÇ"); } } };
            const handleReset = () => { setIsActive(false); setTimeLeft(mode === 'work' ? workMinutes * 60 : breakMinutes * 60); };
            const handleTimerComplete = () => { if (mode === 'work') { speak("Â∞àÊ≥®ÊôÇÈñìÁµêÊùü„ÄÇÁÇ∫‰∫Ü‰Ω†ÁöÑÂÅ•Â∫∑ÔºåÂ§ßÁôΩÂª∫Ë≠∞‰Ω†‰ºëÊÅØ‰∏Ä‰∏ã„ÄÇ"); setMode('break'); setTimeLeft(breakMinutes * 60); } else { speak("‰ºëÊÅØÁµêÊùü„ÄÇ‰Ω†Ê∫ñÂÇôÂ•ΩÁπºÁ∫åÂ∑•‰Ωú‰∫ÜÂóéÔºü"); setMode('work'); setTimeLeft(workMinutes * 60); } };
            const formatTime = (seconds) => { const mins = Math.floor(seconds / 60); const secs = seconds % 60; return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`; };
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-50 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center justify-between p-6 sticky top-0 z-10 bg-slate-50/90 backdrop-blur-md">
                        <div className="flex items-center gap-3"><button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm"><Icons.ChevronLeft className="text-slate-600" /></button><h2 className="text-xl font-bold text-slate-700">Â∞àÊ≥®Ê®°Âºè</h2></div>
                        <button onClick={() => !isActive && setIsSettingsOpen(!isSettingsOpen)} className={`w-10 h-10 rounded-full flex items-center justify-center shadow-sm transition ${isActive ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-white text-slate-600 hover:text-sky-500'}`}><Icons.Settings size={20} /></button>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center p-6 pb-safe-bottom relative">
                        {isSettingsOpen && !isActive && (
                            <div className="absolute inset-0 bg-white/95 backdrop-blur-sm z-20 flex flex-col items-center justify-center p-8 animate-fade-in">
                                <h3 className="text-lg font-bold text-slate-700 mb-6">Ë®≠ÂÆöÊôÇÈñì (ÂàÜÈêò)</h3>
                                <div className="w-full space-y-6">
                                    <div><label className="text-xs font-bold text-slate-400 uppercase mb-2 block">Â∞àÊ≥®ÊôÇÈñì</label><div className="flex items-center gap-4"><input type="range" min="1" max="90" step="1" value={workMinutes} onChange={(e) => setWorkMinutes(Number(e.target.value))} className="flex-1 accent-slate-800" /><span className="text-xl font-mono font-bold text-slate-800 w-12 text-right">{workMinutes}</span></div></div>
                                    <div><label className="text-xs font-bold text-slate-400 uppercase mb-2 block">‰ºëÊÅØÊôÇÈñì</label><div className="flex items-center gap-4"><input type="range" min="1" max="30" step="1" value={breakMinutes} onChange={(e) => setBreakMinutes(Number(e.target.value))} className="flex-1 accent-rose-500" /><span className="text-xl font-mono font-bold text-rose-500 w-12 text-right">{breakMinutes}</span></div></div>
                                </div>
                                <button onClick={() => setIsSettingsOpen(false)} className="mt-8 px-8 py-3 bg-slate-800 text-white rounded-xl font-bold shadow-lg hover:bg-slate-700 transition">ÂÆåÊàêË®≠ÂÆö</button>
                            </div>
                        )}
                        <div className="mb-8 relative"><div className={`absolute inset-0 bg-sky-200 blur-3xl opacity-20 rounded-full transition-all duration-1000 ${isActive ? 'scale-125' : 'scale-100'}`}></div><FullBodyBaymax /></div>
                        <div className="text-center mb-8"><h3 className="text-sm font-bold text-slate-400 uppercase tracking-widest mb-2">{mode === 'work' ? 'FOCUS TIME' : 'RELAX TIME'}</h3><div className="text-6xl font-mono font-bold text-slate-800 tracking-tighter">{formatTime(timeLeft)}</div></div>
                        <div className="flex gap-4 w-full max-w-xs"><button onClick={handleStart} className={`flex-1 py-4 rounded-2xl font-bold text-white shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 ${isActive ? 'bg-rose-500 shadow-rose-200' : 'bg-slate-800 shadow-slate-300'}`}>{isActive ? <Icons.Pause /> : <Icons.Play />}{isActive ? "Êö´ÂÅú" : "ÈñãÂßã"}</button><button onClick={handleReset} className="w-16 bg-white rounded-2xl flex items-center justify-center text-slate-400 hover:text-slate-600 shadow-sm border border-slate-200 active:scale-95 transition"><Icons.RotateCcw size={20} /></button></div>
                    </div>
                </div>
            );
        }

        function ToolMovie({ onBack }) {
            const [movies, setMovies] = useState(() => JSON.parse(localStorage.getItem('baymax_movies') || '[]'));
            const [viewMode, setViewMode] = useState('list');
            const [selectedId, setSelectedId] = useState(null);
            const [loading, setLoading] = useState(false);
            const [newEntry, setNewEntry] = useState({ title: '', rating: 5 });
            useEffect(() => localStorage.setItem('baymax_movies', JSON.stringify(movies)), [movies]);
            const handleAdd = async () => {
                if (!newEntry.title) return alert("Ë´ãËº∏ÂÖ•ÈõªÂΩ±ÂêçÁ®±"); setLoading(true);
                try {
                    const prompt = `Identify the movie/series "${newEntry.title}". JSON structure: { "title": "String", "year": "String", "genre": "String", "director": "String", "plot": "String", "color": "String" }`;
                    const aiData = await callGemini([{ text: newEntry.title }], prompt);
                    const posterUrl = `https://tse1.mm.bing.net/th?q=${encodeURIComponent(aiData.title + " " + aiData.year + " movie poster")}&w=300&h=450&c=7&rs=1&p=0`;
                    const newItem = { id: Date.now(), userRating: newEntry.rating, poster: posterUrl, watchHistory: [], personalReview: "", ...aiData };
                    setMovies(prev => [newItem, ...prev]); setViewMode('list'); setNewEntry({ title: '', rating: 5 });
                } catch (e) { alert("Êâæ‰∏çÂà∞ÈÄôÈÉ®ÈõªÂΩ±..."); } setLoading(false);
            };
            const handleDelete = (id) => { if(confirm("Á¢∫ÂÆöË¶ÅÁßªÈô§ÈÄôÈÉ®ÈõªÂΩ±ÂóéÔºü")) { setMovies(prev => prev.filter(m => m.id !== id)); if(selectedId === id) { setSelectedId(null); setViewMode('list'); } } };
            const handleUpdateMovie = (id, updates) => { setMovies(prev => prev.map(m => m.id === id ? { ...m, ...updates } : m)); };
            const activeMovie = movies.find(m => m.id === selectedId);
            const PosterImage = ({ src, alt, color, title, className }) => {
                const [error, setError] = useState(false);
                if (error) { return (<div className={`flex flex-col items-center justify-center text-center p-2 text-white ${className}`} style={{ background: `linear-gradient(to bottom right, ${color}, #1f2937)` }}><Icons.Film size={32} className="opacity-50 mb-2"/><span className="font-bold text-sm leading-tight line-clamp-3">{title}</span></div>); }
                return <img src={src} alt={alt} onError={() => setError(true)} className={`object-cover ${className}`} />;
            };
            const MovieDetail = ({ movie }) => {
                const [plotEdit, setPlotEdit] = useState(movie.plot);
                const [reviewEdit, setReviewEdit] = useState(movie.personalReview || ""); 
                const [isEditingPlot, setIsEditingPlot] = useState(false);
                const [isEditingReview, setIsEditingReview] = useState(false);
                const [dateInput, setDateInput] = useState('');
                const savePlot = () => { handleUpdateMovie(movie.id, { plot: plotEdit }); setIsEditingPlot(false); };
                const saveReview = () => { handleUpdateMovie(movie.id, { personalReview: reviewEdit }); setIsEditingReview(false); };
                const addHistory = (dateStr) => { if (!dateStr) return; const newHistory = [...(movie.watchHistory || []), dateStr].sort().reverse(); handleUpdateMovie(movie.id, { watchHistory: newHistory }); setDateInput(''); };
                const removeHistory = (indexToRemove) => { const newHistory = (movie.watchHistory || []).filter((_, idx) => idx !== indexToRemove); handleUpdateMovie(movie.id, { watchHistory: newHistory }); };
                return (
                    <div className="flex flex-col h-full animate-slide-up bg-slate-900 overflow-y-auto no-scrollbar relative">
                        <div className="relative h-64 shrink-0"><div className="absolute inset-0 overflow-hidden"><PosterImage src={movie.poster} alt={movie.title} color={movie.color} title={movie.title} className="w-full h-full opacity-60 blur-md scale-110" /><div className="absolute inset-0 bg-gradient-to-b from-transparent via-slate-900/50 to-slate-900"></div></div><div className="absolute top-0 left-0 p-6 w-full flex justify-between items-start z-10"><button onClick={() => { setViewMode('list'); setSelectedId(null); }} className="w-10 h-10 bg-black/30 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/20 text-white transition"><Icons.ChevronLeft /></button><button onClick={() => handleDelete(movie.id)} className="w-10 h-10 bg-black/30 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-rose-500/80 text-white transition"><Icons.Trash2 size={18} /></button></div><div className="absolute -bottom-10 left-6 flex items-end gap-4 z-10"><div className="w-28 h-40 rounded-xl overflow-hidden shadow-2xl border-2 border-white/10 bg-slate-800"><PosterImage src={movie.poster} alt={movie.title} color={movie.color} title={movie.title} className="w-full h-full" /></div></div></div>
                        <div className="px-6 pt-12 pb-20">
                            <h2 className="text-2xl font-bold text-white leading-tight">{movie.title}</h2>
                            <div className="flex gap-2 text-xs text-slate-400 mt-2 font-medium"><span className="bg-white/10 px-2 py-0.5 rounded">{movie.year}</span><span className="bg-white/10 px-2 py-0.5 rounded">{movie.genre.split(',')[0]}</span><span>{movie.director}</span></div>
                            <div className="flex gap-1 my-4 bg-white/5 inline-flex p-2 rounded-xl">{[1, 2, 3, 4, 5].map((star) => (<button key={star} onClick={() => handleUpdateMovie(movie.id, { userRating: star })} className={`${movie.userRating >= star ? 'text-amber-400' : 'text-slate-600'} hover:scale-110 transition`}><Icons.Star size={20} /></button>))}</div>
                            <div className="mb-6 group relative"><div className="flex justify-between items-center mb-1"><label className="text-xs font-bold text-slate-500 uppercase">ÂäáÊÉÖÁ∞°‰ªã</label><button onClick={() => setIsEditingPlot(!isEditingPlot)} className="text-sky-400 hover:text-white p-1"><Icons.Edit3 size={12}/></button></div>{isEditingPlot ? (<div><textarea className="w-full bg-slate-800 text-slate-300 p-3 rounded-xl outline-none focus:ring-1 focus:ring-sky-500 text-sm leading-relaxed" rows="4" value={plotEdit} onChange={e => setPlotEdit(e.target.value)} /><button onClick={savePlot} className="mt-2 bg-sky-500 text-white text-xs px-3 py-1 rounded-lg">ÂÑ≤Â≠ò</button></div>) : (<p className="text-slate-300 text-sm leading-relaxed">{movie.plot}</p>)}</div>
                            <div className="mb-6 group relative"><div className="flex justify-between items-center mb-1"><label className="text-xs font-bold text-slate-500 uppercase">ËßÄÂæåÊÑü</label><button onClick={() => setIsEditingReview(!isEditingReview)} className="text-sky-400 hover:text-white p-1"><Icons.Edit3 size={12}/></button></div>{isEditingReview || !movie.personalReview ? (<div className="bg-slate-800/30 p-2 rounded-xl border border-white/5"><textarea className="w-full bg-transparent text-slate-300 p-2 outline-none text-sm leading-relaxed placeholder-slate-600" rows="3" placeholder="ÂØ´‰∏ã‰Ω†ÁöÑÊÉ≥Ê≥ï..." value={reviewEdit} onChange={e => setReviewEdit(e.target.value)} /><div className="flex justify-end mt-1"><button onClick={saveReview} className="bg-sky-600 text-white text-xs px-3 py-1.5 rounded-lg hover:bg-sky-500 transition">ÂÑ≤Â≠òÂøÉÂæó</button></div></div>) : (<div onClick={() => setIsEditingReview(true)} className="cursor-pointer hover:bg-white/5 p-2 -ml-2 rounded-lg transition"><p className="text-slate-200 text-sm leading-relaxed whitespace-pre-wrap">{movie.personalReview}</p></div>)}</div>
                            <div className="bg-slate-800/50 rounded-2xl p-4 border border-white/5"><div className="flex justify-between items-center mb-4"><div className="flex items-center gap-2 text-white font-bold"><Icons.Calendar size={18} className="text-amber-400"/>ËßÄÂΩ±Êó•Ë®ò <span className="bg-amber-500/20 text-amber-400 text-[10px] px-2 py-0.5 rounded-full">{movie.watchHistory?.length || 0} Âà∑</span></div></div><div className="flex gap-2 mb-4 items-stretch"><button onClick={() => addHistory(new Date().toISOString().split('T')[0])} className="bg-amber-500 hover:bg-amber-600 text-white text-xs font-bold px-4 py-2 rounded-xl transition shadow-lg shadow-amber-500/20 whitespace-nowrap flex items-center">+ ‰ªäÂ§©</button><div className="flex-1 flex gap-2 bg-slate-700 rounded-xl px-2 py-1 items-center border border-slate-600 focus-within:border-sky-500 transition"><input type="date" value={dateInput} onChange={e => setDateInput(e.target.value)} className="bg-transparent text-slate-200 text-xs w-full outline-none"/><button onClick={() => addHistory(dateInput)} disabled={!dateInput} className="text-amber-400 font-bold text-xs px-2 py-1 rounded disabled:opacity-30 hover:bg-slate-600 hover:text-amber-300 transition whitespace-nowrap">Ë£úÁôª</button></div></div><div className="space-y-2 max-h-40 overflow-y-auto pr-1 custom-scrollbar">{(movie.watchHistory || []).map((date, idx) => (<div key={idx} className="flex justify-between items-center bg-slate-900/50 p-2.5 rounded-lg text-sm group border border-transparent hover:border-slate-700 transition"><span className="text-slate-300 font-mono pl-1">{date}</span><button onClick={() => removeHistory(idx)} className="text-slate-600 hover:text-rose-500 p-1 opacity-0 group-hover:opacity-100 transition"><Icons.X size={14}/></button></div>))}{(!movie.watchHistory || movie.watchHistory.length === 0) && (<p className="text-center text-xs text-slate-600 py-2">ÈÇÑÊ≤íÊúâËßÄÂΩ±Á¥ÄÈåÑ</p>)}</div></div>
                        </div>
                    </div>
                );
            };
            if (viewMode === 'detail' && activeMovie) { return <MovieDetail movie={activeMovie} />; }
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-900 text-slate-200 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center justify-between p-6 sticky top-0 z-10 bg-slate-900/90 backdrop-blur-md border-b border-slate-800">
                        <div className="flex items-center gap-3"><button onClick={onBack} className="w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center hover:bg-slate-700"><Icons.ChevronLeft className="text-slate-400" /></button><h2 className="text-xl font-bold text-white">ÂΩ±Ë¶ñÂ∫´</h2></div>
                        {viewMode === 'list' && (<button onClick={() => setViewMode('add')} className="w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center text-white hover:scale-105 active:scale-95 shadow-lg shadow-amber-500/20"><Icons.Plus size={24}/></button>)}
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 no-scrollbar pb-safe-bottom">
                        {viewMode === 'list' ? (
                            <div className="grid grid-cols-2 gap-4 pb-20">
                                {movies.length === 0 && (<div className="col-span-2 text-center py-20 text-slate-600"><Icons.Film size={48} className="mx-auto mb-4 opacity-20"/><p>ÈÇÑÊ≤íÊúâÊî∂ËóèÈõªÂΩ±...</p></div>)}
                                {movies.map((item) => (
                                    <div key={item.id} onClick={() => { setSelectedId(item.id); setViewMode('detail'); }} className="relative group rounded-2xl overflow-hidden shadow-poster aspect-[2/3] bg-slate-800 cursor-pointer transition-transform active:scale-95">
                                        <PosterImage src={item.poster} alt={item.title} color={item.color} title={item.title} className="w-full h-full object-cover transition-transform duration-500" />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-60 md:opacity-0 md:group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-3"><div className="text-xs font-bold text-amber-400 mb-1 flex items-center gap-1"><Icons.Star size={10} /> {item.userRating}{item.watchHistory?.length > 0 && <span className="text-slate-400 text-[10px] ml-1">({item.watchHistory.length}Âà∑)</span>}</div><h3 className="text-sm font-bold text-white leading-tight mb-1 truncate">{item.title}</h3></div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-6 animate-fade-in px-2">
                                <div className="text-center mb-6"><div className="w-20 h-20 bg-slate-800 rounded-3xl mx-auto flex items-center justify-center mb-4 shadow-inner-light"><Icons.Film size={32} className="text-amber-500" /></div><h3 className="text-lg font-bold text-white">Êñ∞Â¢ûÊî∂Ëóè</h3></div>
                                <div className="space-y-4"><div><label className="text-xs text-slate-500 uppercase font-bold ml-1">ÈõªÂΩ± / ÂΩ±ÈõÜÂêçÁ®±</label><input autoFocus className="w-full bg-slate-800 text-white p-4 rounded-2xl mt-2 outline-none focus:ring-2 focus:ring-amber-500 transition-all" placeholder="‰æãÂ¶Ç: Inception" value={newEntry.title} onChange={e => setNewEntry({...newEntry, title: e.target.value})} /></div><div><label className="text-xs text-slate-500 uppercase font-bold ml-1 mb-2 block">‰Ω†ÁöÑË©ïÂàÜ</label><div className="flex gap-2 justify-center bg-slate-800 p-4 rounded-2xl">{[1, 2, 3, 4, 5].map((star) => (<button key={star} onClick={() => setNewEntry({...newEntry, rating: star})} className={`p-1 transition-transform active:scale-125 ${newEntry.rating >= star ? 'text-amber-400' : 'text-slate-600'}`}><svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></button>))}</div></div></div>
                                <div className="pt-8 flex gap-3"><button onClick={() => setViewMode('list')} className="flex-1 py-4 bg-slate-800 text-slate-400 rounded-2xl font-bold hover:bg-slate-700">ÂèñÊ∂à</button><button onClick={handleAdd} disabled={loading} className="flex-1 py-4 bg-amber-500 text-white rounded-2xl font-bold hover:bg-amber-600 disabled:opacity-50 shadow-lg shadow-amber-500/20">{loading ? "ÊêúÂ∞ã‰∏≠..." : "Âä†ÂÖ•Êî∂Ëóè"}</button></div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function ToolPassword({ onBack }) {
            const [passwords, setPasswords] = useState(() => JSON.parse(localStorage.getItem('baymax_passwords') || '[]'));
            const [viewMode, setViewMode] = useState('list');
            const [showPass, setShowPass] = useState({});
            const [loading, setLoading] = useState(false);
            const [newEntry, setNewEntry] = useState({ service: '', username: '', password: '', note: '' });
            useEffect(() => localStorage.setItem('baymax_passwords', JSON.stringify(passwords)), [passwords]);
            const togglePass = (id) => setShowPass(p => ({ ...p, [id]: !p[id] }));
            const handleAdd = async () => {
                if (!newEntry.service || !newEntry.password) return alert("Ë´ãËá≥Â∞ëÂ°´ÂØ´ÊúçÂãôÂêçÁ®±ËàáÂØÜÁ¢º"); setLoading(true);
                try {
                    const aiData = await callGemini([{ text: newEntry.service }], `Categorize "${newEntry.service}" (Social/Work/Finance/Entertainment/Shopping/Utility/Other). JSON: { "category": "String" }`);
                    setPasswords(p => [{ id: Date.now(), ...newEntry, category: aiData.category || "Other" }, ...p]);
                    setViewMode('list'); setNewEntry({ service: '', username: '', password: '', note: '' });
                } catch (e) { setPasswords(p => [{ id: Date.now(), ...newEntry, category: "Other" }, ...p]); setViewMode('list'); } setLoading(false);
            };
            const handleDelete = (id) => { if(confirm("Âà™Èô§Ôºü")) setPasswords(p => p.filter(x => x.id !== id)); };
            const handleExport = () => {
                const text = passwords.map(p => `ÊúçÂãô:${p.service}\nÂ∏≥Ëôü:${p.username}\nÂØÜÁ¢º:${p.password}\nÂÇôË®ª:${p.note}\n---`).join('\n');
                const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([text],{type:'text/plain'})); a.download = `Pass_${new Date().toLocaleDateString()}.txt`; a.click();
            };
            const CategoryBadge = ({ type }) => {
                const c = { "Social": "bg-blue-100 text-blue-600", "Finance": "bg-emerald-100 text-emerald-600", "Work": "bg-slate-200 text-slate-700", "Entertainment": "bg-rose-100 text-rose-600", "Shopping": "bg-orange-100 text-orange-600", "Utility": "bg-purple-100 text-purple-600", "Other": "bg-gray-100 text-gray-500" };
                return <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${c[type]||c["Other"]}`}>{type}</span>;
            };
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-900 text-slate-200 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center justify-between p-6 sticky top-0 z-10 bg-slate-900/90 backdrop-blur-md border-b border-slate-800">
                        <div className="flex items-center gap-3"><button onClick={onBack} className="w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center hover:bg-slate-700"><Icons.ChevronLeft className="text-slate-400" /></button><h2 className="text-xl font-bold text-white">‰øùÈö™ÁÆ±</h2></div>
                        {viewMode==='list' && <button onClick={handleExport} className="p-2 bg-slate-800 rounded-full text-slate-400 hover:text-white"><Icons.Download size={20}/></button>}
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 no-scrollbar pb-safe-bottom">
                        {viewMode === 'list' ? (
                            <div className="space-y-4">
                                <button onClick={() => setViewMode('add')} className="w-full py-4 border-2 border-dashed border-slate-700 rounded-2xl text-slate-500 hover:text-sky-400 hover:border-sky-500/50 hover:bg-slate-800/50 transition flex items-center justify-center gap-2"><Icons.Plus size={20} /><span>Êñ∞Â¢ûÂØÜÁ¢º</span></button>
                                {passwords.map((item) => (
                                    <div key={item.id} className="bg-slate-800 p-5 rounded-2xl border border-slate-700 relative group">
                                        <div className="flex justify-between items-start mb-2"><div><h3 className="text-lg font-bold text-white">{item.service}</h3><CategoryBadge type={item.category} /></div><button onClick={() => handleDelete(item.id)} className="text-slate-600 hover:text-rose-500 p-1"><Icons.Trash2 size={16}/></button></div>
                                        <div className="space-y-2 text-sm mt-3">
                                            {item.username && <div className="flex items-center gap-2 text-slate-400"><span className="text-xs uppercase tracking-wider opacity-50 w-8">User</span><span className="text-slate-200 select-all">{item.username}</span></div>}
                                            <div className="flex items-center gap-2 text-slate-400"><span className="text-xs uppercase tracking-wider opacity-50 w-8">Pass</span><span className="text-sky-300 font-mono tracking-wider flex-1">{showPass[item.id] ? item.password : "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}</span><button onClick={() => togglePass(item.id)} className="text-slate-500 hover:text-white">{showPass[item.id] ? <Icons.EyeOff size={14}/> : <Icons.Eye size={14}/>}</button></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-4 animate-fade-in">
                                <div><label className="text-xs text-slate-500 uppercase font-bold ml-1">ÊúçÂãôÂêçÁ®±</label><input autoFocus className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 outline-none focus:ring-2 focus:ring-sky-500" placeholder="‰æãÂ¶Ç: Netflix" value={newEntry.service} onChange={e => setNewEntry({...newEntry, service: e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 uppercase font-bold ml-1">Â∏≥Ëôü</label><input className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 outline-none focus:ring-2 focus:ring-sky-500" value={newEntry.username} onChange={e => setNewEntry({...newEntry, username: e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 uppercase font-bold ml-1">ÂØÜÁ¢º</label><input className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 outline-none focus:ring-2 focus:ring-sky-500" value={newEntry.password} onChange={e => setNewEntry({...newEntry, password: e.target.value})} /></div>
                                <div><label className="text-xs text-slate-500 uppercase font-bold ml-1">ÂÇôË®ª</label><input className="w-full bg-slate-800 text-white p-4 rounded-xl mt-1 outline-none focus:ring-2 focus:ring-sky-500" value={newEntry.note} onChange={e => setNewEntry({...newEntry, note: e.target.value})} /></div>
                                <div className="pt-4 flex gap-3"><button onClick={() => setViewMode('list')} className="flex-1 py-4 bg-slate-800 text-slate-400 rounded-xl font-bold">ÂèñÊ∂à</button><button onClick={handleAdd} disabled={loading} className="flex-1 py-4 bg-sky-500 text-white rounded-xl font-bold hover:bg-sky-600 disabled:opacity-50">{loading ? "..." : "ÂÑ≤Â≠ò"}</button></div>
                            </div>
                        )}
                    </div>
                </div>
            )
        }

        function ToolBaymax({ onBack }) {
            const [step, setStep] = useState('idle');
            const [images, setImages] = useState([]);
            const [result, setResult] = useState(null);
            const [loadingTip, setLoadingTip] = useState("ÊéÉÊèè‰∏≠...");
            useEffect(() => { if(step==='analyzing'){ const t=["ÂàÜÊûêÁÜ±Èáè...","Â§ßÁôΩÊéÉÊèè‰∏≠..."]; let i=0; const id=setInterval(()=>setLoadingTip(t[i++%2]),2000); return ()=>clearInterval(id); }},[step]);
            const handleAnalyze = async () => { 
                if(!images.length)return; setStep('analyzing');
                try {
                    const parts = await Promise.all(images.map(async i=>({inlineData:{data:await new Promise(r=>{const rd=new FileReader();rd.readAsDataURL(i.file);rd.onload=()=>r(rd.result.split(',')[1])}),mimeType:i.file.type}})));
                    const data = await callGemini([...parts,{text:"ÂàÜÊûêÈ£üÂìÅ"}], `‰Ω†ÊòØÂ§ßÁôΩ,ÂàÜÊûêÈ£üÂìÅÊ®ôÁ§∫„ÄÇJSON:{productName:"S",title:"S",verdict:{color:"green|red|yellow"},highlights:[{label:"S",value:"S",desc:"S"}],advice:{action:"S"}}`);
                    setResult(data); setStep('result');
                } catch(e){ alert(e.message); setStep('idle'); }
            };
            const handleFile=(e)=>{ if(e.target.files.length) setImages(prev=>[...prev,...Array.from(e.target.files).map(f=>({file:f,preview:URL.createObjectURL(f)}))]) };
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-50 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center gap-3 p-6 sticky top-0 z-10 bg-slate-50/90 backdrop-blur">
                        <button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm"><Icons.ChevronLeft className="text-slate-600" /></button>
                        <h2 className="text-xl font-bold text-slate-700">ÂÅ•Â∫∑Â§ßÁôΩ</h2>
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 no-scrollbar pb-safe-bottom">
                        {step === 'idle' && (
                            <div className="space-y-4 h-full flex flex-col">
                                <div className="bg-white rounded-[2rem] p-6 shadow-soft text-center flex-1">
                                    <div className="grid grid-cols-2 gap-3 mb-4">
                                        {images.map((img, i) => (
                                            <div key={i} className="relative aspect-square rounded-2xl overflow-hidden shadow-inner">
                                                <img src={img.preview} className="w-full h-full object-cover" />
                                                <button onClick={() => setImages(images.filter((_,idx)=>idx!==i))} className="absolute top-1 right-1 bg-black/50 text-white rounded-full p-1"><Icons.X size={12}/></button>
                                            </div>
                                        ))}
                                        <label className="aspect-square flex flex-col items-center justify-center bg-slate-50 rounded-2xl cursor-pointer hover:bg-slate-100 transition border-2 border-dashed border-slate-200">
                                            <input type="file" multiple accept="image/*" onChange={handleFile} className="hidden" />
                                            <Icons.Camera className="text-slate-400" />
                                        </label>
                                    </div>
                                </div>
                                <button onClick={handleAnalyze} disabled={!images.length} className="w-full bg-slate-900 text-white py-5 rounded-2xl font-bold shadow-lg shadow-slate-300 disabled:opacity-50">ÂïüÂãïÊéÉÊèè</button>
                            </div>
                        )}
                        {step === 'analyzing' && <div className="h-full flex flex-col items-center justify-center"><BaymaxEyes /><p className="mt-4 text-slate-400">{loadingTip}</p></div>}
                        {step === 'result' && result && (
                            <div className="space-y-4 animate-slide-up">
                                <div className="bg-white rounded-[2rem] p-6 shadow-soft">
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-2xl font-black text-slate-800">{result.productName}</h3>
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${result.verdict.color==='green'?'bg-emerald-100 text-emerald-600':result.verdict.color==='red'?'bg-rose-100 text-rose-600':'bg-yellow-100 text-yellow-600'}`}>‚óè</div>
                                    </div>
                                    <p className="text-slate-600 font-bold mb-4">"{result.title}"</p>
                                    <div className="grid grid-cols-2 gap-3">
                                        {result.highlights.map((h,i)=><div key={i} className="bg-slate-50 p-3 rounded-2xl text-center"><div className="text-xs text-slate-400">{h.label}</div><div className="font-black text-slate-800">{h.value}</div></div>)}
                                    </div>
                                </div>
                                <div className="bg-slate-800 text-white p-6 rounded-[2rem]"><p>"{result.advice.action}"</p></div>
                                <button onClick={()=>setStep('idle')} className="w-full py-4 text-slate-400 font-bold">ÂÜçÊ∏¨‰∏ÄÊ¨°</button>
                            </div>
                        )}
                    </div>
                </div>
            )
        }

        function ToolVocab({ onBack }) {
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('vocab_history') || '[]'));
            useEffect(() => localStorage.setItem('vocab_history', JSON.stringify(history)), [history]);
            const handleSearch = async () => {
                if (!input.trim()) return; setLoading(true);
                try {
                    const data = await callGemini([{ text: input }], `‰Ω†ÊòØË™ûË®ÄÂ≠∏ÁøíÂä©Êâã„ÄÇËß£ÈáãÂñÆÂ≠ó"${input}"„ÄÇJSON:{word:"S",meaning:"S",type:"S",example:"S",exampleTrans:"S"}`);
                    setHistory(p => [{...data, id:Date.now()}, ...p]); setInput("");
                } catch (e) { alert("Error"); } setLoading(false);
            };
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-50 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                     <div className="flex items-center gap-3 p-6 sticky top-0 z-10 bg-slate-900/90 backdrop-blur">
                        <button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm"><Icons.ChevronLeft className="text-slate-600" /></button>
                        <h2 className="text-xl font-bold text-slate-700">Ë®òÊÜ∂Êô∂Áâá</h2>
                    </div>
                    <div className="px-6 mb-4">
                        <div className="flex gap-2 bg-white p-2 rounded-[1.5rem] shadow-soft">
                            <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&handleSearch()} placeholder="Ëº∏ÂÖ•ÂñÆÂ≠ó..." className="flex-1 px-4 bg-transparent outline-none"/>
                            <button onClick={handleSearch} className="w-10 h-10 bg-rose-500 text-white rounded-full flex items-center justify-center shadow-lg shadow-rose-200">{loading?<div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"/>:<Icons.Sparkles size={18}/>}</button>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto px-6 no-scrollbar space-y-3 pb-safe-bottom">
                        {history.map(item => (
                            <div key={item.id} className="bg-white p-5 rounded-[1.5rem] shadow-soft relative group">
                                <button onClick={()=>setHistory(h=>h.filter(i=>i.id!==item.id))} className="absolute top-4 right-4 text-slate-300 hover:text-rose-500"><Icons.Trash2 size={16}/></button>
                                <h3 className="text-xl font-black text-slate-800">{item.word} <span className="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-full font-bold ml-2 align-middle">{item.type}</span></h3>
                                <p className="text-slate-600 font-bold mb-2">{item.meaning}</p>
                                <p className="text-sm text-slate-400 italic">"{item.example}"</p>
                            </div>
                        ))}
                    </div>
                </div>
            )
        }

        function ToolClothes({ onBack }) {
            const [step, setStep] = useState('idle');
            const [image, setImage] = useState(null);
            const [result, setResult] = useState(null);
            const [loadingTip, setLoadingTip] = useState("Ê≠£Âú®ËÆÄÂèñÊ®ôÁ±§...");
            useEffect(() => { if(step==='analyzing'){ const t=["Ê≠£Âú®Ëæ®Ë≠òÊ¥óË°£Á¨¶Ëôü...","ÂàÜÊûêÊùêË≥™ÊàêÂàÜ..."]; let i=0; const timer=setInterval(()=>setLoadingTip(t[i++%t.length]),2000); return ()=>clearInterval(timer); } }, [step]);
            const handleAnalyze = async () => {
                if (!image) return; setStep('analyzing');
                try {
                    const imgData = await new Promise(r => { const reader=new FileReader(); reader.readAsDataURL(image.file); reader.onload=()=>r(reader.result.split(',')[1]); });
                    const prompt = `‰Ω†ÊòØÂ§ßÁôΩÔºåË´ãËæ®Ë≠òË°£Áâ©Ê¥óÊ®ôÁ¨¶ËôüËàáÊùêË≥™„ÄÇJSONÁµêÊßã: { "garmentType": "String", "materials": ["String"], "careInstructions": [{"icon": "String", "text": "String"}], "baymaxTip": "String" }`;
                    const data = await callGemini([{ inlineData: { data: imgData, mimeType: image.file.type } }, { text: "ÂàÜÊûêÈÄôÂÄãÊ¥óÊ®ô" }], prompt);
                    setResult(data); setStep('result');
                } catch (e) { alert("ÊéÉÊèèÂ§±Êïó"); setStep('idle'); }
            };
            const handleFile = (e) => { const file = e.target.files[0]; if(file) setImage({ file, preview: URL.createObjectURL(file) }); };
            return (
                <div className="flex flex-col h-full animate-slide-up bg-slate-50 md:rounded-[2.5rem] overflow-hidden pt-safe-top">
                    <div className="flex items-center gap-3 p-6 sticky top-0 z-10 bg-slate-900/90 backdrop-blur">
                        <button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-sm"><Icons.ChevronLeft className="text-slate-600" /></button>
                        <h2 className="text-xl font-bold text-slate-700">Ë°£Áâ©Ë≠∑ÁêÜ</h2>
                    </div>
                    <div className="flex-1 overflow-y-auto p-6 no-scrollbar pb-safe-bottom">
                        {step === 'idle' && (
                            <div className="space-y-6 h-full flex flex-col">
                                <div className="bg-white rounded-[2rem] p-8 shadow-soft text-center flex-1 flex flex-col justify-center items-center relative overflow-hidden">
                                    {image ? (
                                        <div className="relative w-full h-64 rounded-2xl overflow-hidden shadow-inner mb-4">
                                            <img src={image.preview} className="w-full h-full object-contain bg-slate-100" />
                                            <button onClick={() => setImage(null)} className="absolute top-2 right-2 bg-slate-900/50 text-white rounded-full p-2"><Icons.X size={16}/></button>
                                        </div>
                                    ) : (
                                        <label className="w-full h-64 border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center cursor-pointer hover:bg-slate-50 transition gap-4">
                                            <input type="file" accept="image/*" onChange={handleFile} className="hidden" />
                                            <Icons.Camera size={32} className="text-rose-400"/>
                                            <span className="text-slate-400 font-medium">ÊãçÊîùÊ¥óÊ®ô</span>
                                        </label>
                                    )}
                                </div>
                                <button onClick={handleAnalyze} disabled={!image} className="w-full bg-slate-900 text-white py-5 rounded-2xl font-bold shadow-lg disabled:opacity-30">ÈñãÂßãËß£ËÆÄ</button>
                            </div>
                        )}
                        {step === 'analyzing' && <div className="h-full flex flex-col items-center justify-center"><Icons.Shirt className="text-rose-400 w-10 h-10 animate-bounce"/><p className="mt-4 text-slate-400">{loadingTip}</p></div>}
                        {step === 'result' && result && (
                            <div className="space-y-4 animate-slide-up">
                                <div className="flex justify-center -mb-8 relative z-10"><div className="w-24 h-24 rounded-2xl overflow-hidden border-4 border-white shadow-lg rotate-3 bg-white"><img src={image.preview} className="w-full h-full object-cover" /></div></div>
                                <div className="bg-white rounded-[2rem] p-6 pt-10 shadow-soft flex flex-col items-center text-center">
                                    <h3 className="text-2xl font-black text-slate-800 mt-2">{result.garmentType}</h3>
                                    <div className="flex gap-2 mt-2">{result.materials.map((m,i)=><span key={i} className="bg-slate-100 text-slate-600 text-xs font-bold px-3 py-1 rounded-full">{m}</span>)}</div>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {result.careInstructions.map((care, i) => <div key={i} className="bg-white p-4 rounded-2xl shadow-soft flex flex-col items-center text-center"><div className="text-4xl mb-2">{care.icon}</div><div className="text-sm font-bold text-slate-700">{care.text}</div></div>)}
                                </div>
                                <div className="bg-slate-800 text-white p-6 rounded-[2rem] relative overflow-hidden"><p className="text-lg font-medium leading-relaxed">"{result.baymaxTip}"</p></div>
                                <button onClick={() => setStep('idle')} className="w-full py-4 text-center text-slate-400 font-bold">ÊéÉÊèè‰∏ã‰∏Ä‰ª∂</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ==========================================
        // üì± ‰∏ªÁ®ãÂºèÔºöBaymax OS
        // ==========================================
        function App() {
            const [view, setView] = useState('home');

            const tools = [
                { id: 'baymax', name: 'ÂÅ•Â∫∑Â§ßÁôΩ', icon: <Icons.Stethoscope size={28} />, desc: 'È£üÂìÅÁáüÈ§äÂàÜÊûê' },
                { id: 'vocab', name: 'Ë®òÊÜ∂Êô∂Áâá', icon: <Icons.BookA size={28} />, desc: 'ÂñÆÂ≠óÂ∫´' },
                { id: 'learning', name: 'Â≠∏ÁøíÂä©Êâã', icon: <Icons.GraduationCap size={28} />, desc: 'Ëß£È°å/ÂïèÁ≠î/ÊñáÊ≥ï' },
                { id: 'clothes', name: 'Ë°£Áâ©Ë≠∑ÁêÜ', icon: <Icons.Shirt size={28} />, desc: 'Ê¥óÊ®ôËæ®Ë≠ò' },
                { id: 'password', name: '‰øùÈö™ÁÆ±', icon: <Icons.Lock size={28} />, desc: 'ÂØÜÁ¢ºÁÆ°ÁêÜ' },
                { id: 'movie', name: 'ÂΩ±Ë¶ñÂ∫´', icon: <Icons.Film size={28} />, desc: 'ÈõªÂΩ±Êî∂Ëóè' },
                { id: 'pomodoro', name: 'Â∞àÊ≥®Ê®°Âºè', icon: <Icons.Timer size={28} />, desc: 'Áï™ËåÑÈêò' },
                { id: 'coming', name: 'Êì¥ÂÖÖÊßΩ', icon: <Icons.Plus size={24} />, desc: 'Á©∫ÁΩÆ' },
            ];

            return (
                <div className="w-full h-[100dvh] bg-slate-200 md:bg-slate-100 md:max-w-md md:h-[850px] md:rounded-[3.5rem] md:shadow-xl md:shadow-slate-300 relative flex flex-col md:border-[14px] md:border-slate-900 overflow-hidden font-sans">
                    
                    {/* Baymax È†ÇÈÉ®Ë≠òÂà•ÂçÄ */}
                    <div className="bg-white h-24 rounded-b-[2.5rem] shadow-soft flex flex-col items-center justify-end pb-4 shrink-0 relative z-20">
                         <BaymaxEyes />
                         <div className="text-[10px] font-bold text-slate-300 tracking-[0.3em] mt-3 uppercase">Personal Companion</div>
                    </div>

                    <div className="flex-1 bg-slate-100 p-6 overflow-hidden relative">
                        {view === 'home' && (
                            <div className="h-full flex flex-col animate-fade-in pt-4">
                                <div className="mb-8 px-2">
                                    <h1 className="text-3xl font-black text-slate-800 leading-tight">‰Ω†Â•Ω„ÄÇ<br/>ÊàëÊòØ<span className="text-rose-500">Â§ßÁôΩ</span>„ÄÇ</h1>
                                    <p className="text-slate-400 mt-2 font-medium">‰Ω†ÁöÑÂÄã‰∫∫ÂÅ•Â∫∑Ë≠∑ÁêÜÂä©ÁêÜ„ÄÇ</p>
                                </div>
                                <div className="grid grid-cols-2 gap-6 auto-rows-fr pb-safe-bottom no-scrollbar overflow-y-auto">
                                    {tools.map((tool) => (
                                        <button 
                                            key={tool.id}
                                            onClick={() => { if(!tool.id.startsWith('coming')) setView(tool.id) }}
                                            className={`p-5 rounded-[2.5rem] text-left transition-all duration-300 flex flex-col justify-between aspect-square group relative overflow-hidden active:scale-95 shadow-card hover:shadow-soft bg-white border border-slate-100
                                                ${tool.id.startsWith('coming') ? 'opacity-50 cursor-default' : ''}`}
                                        >
                                            <div className="w-14 h-14 rounded-full flex items-center justify-center mb-2 bg-slate-50 text-slate-600 group-hover:bg-rose-50 group-hover:text-rose-500 transition-colors">
                                                {tool.icon}
                                            </div>
                                            <div className="relative z-10">
                                                <div className="font-bold text-lg text-slate-700">{tool.name}</div>
                                                <div className="text-[11px] opacity-60 mt-1 font-medium tracking-wide text-slate-500">{tool.desc}</div>
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'baymax' && <ToolBaymax onBack={() => setView('home')} />}
                        {view === 'vocab' && <ToolVocab onBack={() => setView('home')} />}
                        {view === 'clothes' && <ToolClothes onBack={() => setView('home')} />}
                        {view === 'password' && <ToolPassword onBack={() => setView('home')} />}
                        {view === 'movie' && <ToolMovie onBack={() => setView('home')} />}
                        {view === 'pomodoro' && <ToolPomodoro onBack={() => setView('home')} />}
                        {view === 'learning' && <ToolLearning onBack={() => setView('home')} />}
                    </div>
                    
                    {/* Â∫ïÈÉ®Ë£ùÈ£æÊ¢ù (Ê®°Êì¨ÊâãÊ©üHome Bar) */}
                    <div className="absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1 bg-slate-300 rounded-full md:mb-4"></div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
